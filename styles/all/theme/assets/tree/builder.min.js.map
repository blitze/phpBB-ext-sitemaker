{"version":3,"sources":["tree/builder.min.js"],"names":["$","window","document","undefined","lang","Twig","codeMirror","widget","options","ajaxUrl","loadSpeed","fields","itemId","itemTitle","parentId","listType","noNesting","nestedList","editForm","noItems","addBtn","addBulkBtn","addBulkList","saveBtn","deleteSelBtn","rebuildBtn","selectAll","loading","ajaxMessage","itemTemplate","actionClass","selectItemClass","iconSelectClass","dialogEdit","dialogConfirm","loaded","updated","_create","self","this","eButtons","dButtons","sButtons","element","addClass","find","nestedSortable","disableNesting","forcePlaceholderSize","handle","helper","items","opacity","placeholder","tabSize","tolerance","toleranceElement","errorClass","update","itemsChanged","button","selectAllObj","click","prop","checked","deleteChildNodes","node","itemID","_removeNode","dialog","_saveTree","deleteNode","children","length","appendTo","parent","cancel","saveNode","_checkRequired","_submitForm","dialogID","parentsUntil","each","defDialog","autoOpen","modal","width","show","hide","msgObj","loader","ajaxStart","fadeIn","ajaxStop","fadeOut","ajaxComplete","event","xhr","responseJSON","message","showMessage","ajaxError","errorMessage","onbeforeunload","e","returnValue","unsavedChanges","events","numSelected","_makeEditable","target","_processEditable","preventDefault","trigger","action","currentTarget","data","_getItemId","_populateForm","buttons","editNode","extend","_on","icons","primary","populate","addNode","addItem","text","$button","toggleClass","blur","$dropdown","next","pos","offset","form","slideToggle","top","height","left","hasClass","none","html","_getOptions","val","buttonset","add_list","getValue","setValue","clearHistory","_addBulk","param","disabled","addBtnOffset","twig","id","CodeMirror","fromTextArea","get","theme","lineNumbers","lineWrapping","autoRefresh","styleActiveLine","fixedGutter","coverGutterNextToScrollbar","indentWithTabs","indentUnit","getItems","_saveItem","updateItem","getJSON","empty","_resetActions","_showActions","_addToTree","getCodeMirrorInstance","delay","post","resp","error","callback","item","shift","changeMe","parentObj","_renderItem","effect","direction","mode","apply","_trigger","remove","response","required","insertAfter","attr","substring","list","padding","i","option","editing","editorVal","replaceWith","editor","focus","select","callBack","field","_undoEditable","itemsCount","display","slideUp","css","_scrollTo","_refreshItem","tree","fromHeight","totalScroll","animate","scrollTop","siblings","not","ref","render","replacement","v","serializeArray","jQuery"],"mappings":"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","file":"builder.min.js","sourcesContent":["/*!\n * Sitemaker treeBuilder\n * Author: @blitze\n * Licensed under the GPL license\n */\n\n;(function($, window, document, undefined) {\n\t'use strict';\n\n\tvar lang = window.lang || {};\n\tvar Twig = window.Twig || {};\n\tvar codeMirror = {};\n\n\t$.widget('sitemaker.treeBuilder', {\n\t\toptions: {\n\t\t\tajaxUrl: '',\n\t\t\tloadSpeed: 10,\n\n\t\t\tfields: {\n\t\t\t\titemId: 'item_id',\n\t\t\t\titemTitle: 'item_title',\n\t\t\t\tparentId: 'parent_id'\n\t\t\t},\n\n\t\t\tlistType: 'ol',\n\t\t\tnoNesting: '.no-nest',\n\t\t\tnestedList: '#sortable',\n\t\t\teditForm: '#edit-form',\n\t\t\tnoItems: '#no-items',\n\n\t\t\taddBtn: '#add-new',\n\t\t\taddBulkBtn: '#add-bulk',\n\t\t\taddBulkList: '#add_list',\n\t\t\tsaveBtn: '#save',\n\t\t\tdeleteSelBtn: '#delete-selected',\n\t\t\trebuildBtn: '#rebuild-tree',\n\n\t\t\tselectAll: '#select-all',\n\t\t\tloading: '#loading',\n\t\t\tajaxMessage: '#ajax-message',\n\t\t\titemTemplate: '#item-template',\n\t\t\tactionClass: '.item-action',\n\t\t\tselectItemClass: '.select-item',\n\t\t\ticonSelectClass: '.icon-select',\n\n\t\t\tdialogEdit: '',\n\t\t\tdialogConfirm: '#dialog-confirm',\n\n\t\t\tloaded: function() {},\n\t\t\tupdated: function() {}\n\t\t},\n\n\t\t_create: function() {\n\t\t\tvar self = this;\n\t\t\tvar eButtons = {};\n\t\t\tvar dButtons = {};\n\t\t\tvar sButtons = {};\n\n\t\t\t// call nested sortable\n\t\t\tthis.nestedList = this.element.addClass('tree-builder').find(this.options.nestedList).nestedSortable({\n\t\t\t\tdisableNesting: this.options.noNesting,\n\t\t\t\tforcePlaceholderSize: true,\n\t\t\t\tlistType: this.options.listType,\n\t\t\t\thandle: 'div',\n\t\t\t\thelper:\t'clone',\n\t\t\t\titems: 'li',\n\t\t\t\topacity: 0.6,\n\t\t\t\tplaceholder: 'placeholder',\n\t\t\t\ttabSize: 25,\n\t\t\t\ttolerance: 'pointer',\n\t\t\t\ttoleranceElement: '> div',\n\t\t\t\terrorClass: this.options.ajaxMessage,\n\t\t\t\tupdate: function() {\n\t\t\t\t\tself.itemsChanged = true;\n\t\t\t\t\tif (self.saveBtn.button('option', 'disabled')) {\n\t\t\t\t\t\tself.saveBtn.button('option', 'disabled', false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.selectAllObj = this.element.find(this.options.selectAll).click(function() {\n\t\t\t\tself.nestedList.find(self.options.selectItemClass).prop('checked', this.checked);\n\t\t\t\tif (this.checked) {\n\t\t\t\t\tself.deleteSelBtn.button('enable');\n\t\t\t\t} else {\n\t\t\t\t\tself.deleteSelBtn.button('disable');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// register dialogs\n\t\t\tdButtons[lang.deleteChildNodes] = function() {\n\t\t\t\tvar node = $('li#item-' + self.itemID);\n\t\t\t\tself._removeNode(node);\n\t\t\t\t$(this).dialog('close');\n\t\t\t\tself._saveTree();\n\t\t\t};\n\n\t\t\tdButtons[lang.deleteNode] = function() {\n\t\t\t\tvar node = $('li#item-' + self.itemID);\n\t\t\t\tif (node.children(self.options.listType).length) {\n\t\t\t\t\tnode.children(self.options.listType).children('li').appendTo(node.parent(self.options.listType));\n\t\t\t\t}\n\t\t\t\tself._removeNode(node);\n\t\t\t\t$(this).dialog('close');\n\t\t\t\tself._saveTree();\n\t\t\t};\n\n\t\t\tdButtons[lang.cancel] = function() {\n\t\t\t\t$(this).dialog('close');\n\t\t\t};\n\n\t\t\teButtons[lang.saveNode] = function() {\n\t\t\t\tif (self._checkRequired()) {\n\t\t\t\t\tself._submitForm(self.itemID);\n\t\t\t\t\t$(this).dialog('close');\n\t\t\t\t}\n\t\t\t};\n\n\t\t\teButtons[lang.cancel] = function() {\n\t\t\t\t$(self.dialogID).dialog('close');\n\t\t\t};\n\n\t\t\tsButtons[lang.deleteNode] = function() {\n\t\t\t\tself.element.find(self.options.selectItemClass + ':checked').parentsUntil('li').parent().each(function() {\n\t\t\t\t\tself._removeNode($(this));\n\t\t\t\t});\n\t\t\t\tself._saveTree();\n\t\t\t\t$(this).dialog('close');\n\t\t\t};\n\n\t\t\tsButtons[lang.cancel] = function() {\n\t\t\t\t$(this).dialog('close');\n\t\t\t};\n\n\t\t\tvar defDialog = {\n\t\t\t\tautoOpen: false,\n\t\t\t\tmodal: true,\n\t\t\t\twidth: 'auto',\n\t\t\t\tshow: 'slide',\n\t\t\t\thide: 'slide'\n\t\t\t};\n\n\t\t\t$(this.options.dialogEdit).dialog(defDialog);\n\t\t\t$(this.options.dialogConfirm).dialog(defDialog);\n\n\t\t\t// register events\n\t\t\tthis.msgObj = this.element.find(this.options.ajaxMessage);\n\n\t\t\tvar loader = this.element.find(this.options.loading);\n\t\t\t$(document).ajaxStart(function() {\n\t\t\t\tloader.fadeIn();\n\t\t\t}).ajaxStop(function() {\n\t\t\t\tloader.fadeOut();\n\t\t\t}).ajaxComplete(function(event, xhr) {\n\t\t\t\tif (xhr.responseJSON) {\n\t\t\t\t\t// Display any returned message\n\t\t\t\t\tif (xhr.responseJSON.message) {\n\t\t\t\t\t\tself.showMessage(xhr.responseJSON.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).ajaxError(function() {\n\t\t\t\tself.showMessage(lang.errorMessage);\n\t\t\t});\n\n\t\t\twindow.onbeforeunload = function(e) {\n\t\t\t\tif (self.itemsChanged === true) {\n\t\t\t\t\te = e || window.event;\n\t\t\t\t\t// For IE and Firefox\n\t\t\t\t\tif (e) {\n\t\t\t\t\t\te.returnValue = lang.unsavedChanges;\n\t\t\t\t\t}\n\t\t\t\t\t// For Safari\n\t\t\t\t\treturn lang.unsavedChanges;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tvar events = {};\n\t\t\tevents['click' + this.options.selectItemClass] = function() {\n\t\t\t\tvar numSelected = this.element.find(this.options.selectItemClass + ':checked').length;\n\t\t\t\tif (numSelected > 0) {\n\t\t\t\t\tthis.deleteSelBtn.button('enable');\n\t\t\t\t} else {\n\t\t\t\t\tthis.deleteSelBtn.button('disable');\n\t\t\t\t}\n\t\t\t\tif (numSelected === this.element.find(this.options.selectItemClass).length) {\n\t\t\t\t\tthis.selectAllObj.prop('checked', true);\n\t\t\t\t} else {\n\t\t\t\t\tthis.selectAllObj.prop('checked', false);\n\t\t\t\t}\n\t\t\t};\n\t\t\tevents['click.editable'] = function(event) {\n\t\t\t\tthis._makeEditable($(event.target));\n\t\t\t};\n\t\t\tevents['blur#inline-edit'] = function(event) {\n\t\t\t\tthis._processEditable($(event.target));\n\t\t\t};\n\t\t\tevents['submit#inline-form'] = function(event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\t$(event.target).find('#inline-edit').trigger('blur');\n\t\t\t};\n\t\t\tevents['click' + this.options.actionClass] = function(event) {\n\t\t\t\tvar action = $(event.currentTarget).data('action');\n\n\t\t\t\tthis.itemID = self._getItemId($(event.currentTarget));\n\n\t\t\t\tswitch (action) {\n\t\t\t\t\tcase 'edit':\n\t\t\t\t\t\tthis.dialogID = this.options.dialogEdit;\n\t\t\t\t\t\tthis._populateForm(this.itemID, function(dialogID) {\n\t\t\t\t\t\t\t$(dialogID).dialog({buttons: eButtons}).dialog('option', 'title', lang.editNode).dialog('open');\n\t\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'delete':\n\t\t\t\t\t\tvar buttons = $.extend({}, dButtons);\n\n\t\t\t\t\t\tthis.dialogID = this.options.dialogConfirm;\n\n\t\t\t\t\t\tif ($('#item-' + this.itemID).children(this.options.listType).children('li').length < 1) {\n\t\t\t\t\t\t\tdelete buttons[lang.deleteChildNodes];\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$(this.dialogID).dialog({buttons: buttons}).dialog('open');\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis._on(this.document, events);\n\n\t\t\t// set button events\n\t\t\tthis.addBtn = this.element.find(this.options.addBtn).button({\n\t\t\t\ticons: {\n\t\t\t\t\tprimary: 'ui-icon-plus'\n\t\t\t\t}\n\t\t\t}).click(function(event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tif (self.options.dialogEdit.length) {\n\t\t\t\t\tself.itemID = undefined;\n\t\t\t\t\tself.dialogID = self.options.dialogEdit;\n\t\t\t\t\tself.editForm.populate({});\n\t\t\t\t\t$(self.dialogID).dialog({buttons: eButtons}).dialog('option', 'title', lang.addNode).dialog('open');\n\t\t\t\t} else {\n\t\t\t\t\tself.addItem();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.addBulkBtn = this.element.find(this.options.addBulkBtn).button({\n\t\t\t\ttext: false,\n\t\t\t\ticons: {\n\t\t\t\t\tprimary: 'ui-icon-triangle-1-s'\n\t\t\t\t}\n\t\t\t}).click(function(e) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tvar $button = $(e.currentTarget).toggleClass('dropped').blur();\n\t\t\t\tvar $dropdown = $button.parent().next();\n\t\t\t\tvar width = $dropdown.width();\n\t\t\t\tvar pos = $button.offset();\n\n\t\t\t\tvar form = $dropdown.slideToggle().offset({\n\t\t\t\t\ttop: pos.top + $button.height() + 10,\n\t\t\t\t\tleft: pos.left - (width / 2) + $button.width()\n\t\t\t\t});\n\n\t\t\t\tif ($button.hasClass('dropped') === true) {\n\t\t\t\t\tvar options = '<option value=\"0\">' + lang.none + '</option>';\n\t\t\t\t\tform.find('select').html(self._getOptions(self.nestedList, '', options)).next().val();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.addBulkBtn.parent().buttonset().show().next().hide().find('#cancel').click(function() {\n\t\t\t\tself.addBulkBtn.trigger('click');\n\t\t\t}).next().click(function(event) {\n\t\t\t\tvar form = $(event.target).parentsUntil('form').parent();\n\t\t\t\tvar data = {\n\t\t\t\t\t'add_list': codeMirror.getValue()\n\t\t\t\t};\n\n\t\t\t\tdata[self.options.fields.parentId] = form.find('#parent_id').val();\n\n\t\t\t\t// reset codemirror\n\t\t\t\tcodeMirror.setValue(\"\");\n\t\t\t\tcodeMirror.clearHistory();\n\n\t\t\t\tself._addBulk($.param(data));\n\t\t\t\tself.addBulkBtn.trigger('click');\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\n\t\t\tthis.rebuildBtn = this.element.find(this.options.rebuildBtn).button({\n\t\t\t\tdisabled: true,\n\t\t\t\ticons: {\n\t\t\t\t\tprimary: 'ui-icon-refresh'\n\t\t\t\t}\n\t\t\t}).click(function(event) {\n\t\t\t\tself._saveTree();\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\n\t\t\tthis.deleteSelBtn = this.element.find(this.options.deleteSelBtn).button({\n\t\t\t\tdisabled: true,\n\t\t\t\ticons: {\n\t\t\t\t\tprimary: 'ui-icon-trash'\n\t\t\t\t}\n\t\t\t}).click(function(event) {\n\t\t\t\tself.dialogID = self.options.dialogConfirm;\n\t\t\t\t$(self.dialogID).dialog({buttons: sButtons}).dialog('open');\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\n\t\t\tthis.saveBtn = this.element.find(this.options.saveBtn).button({\n\t\t\t\tdisabled: true,\n\t\t\t\ticons: {\n\t\t\t\t\tprimary: 'ui-icon-check'\n\t\t\t\t}\n\t\t\t}).click(function(event) {\n\t\t\t\tif (self.itemsChanged === true) {\n\t\t\t\t\tself._saveTree();\n\t\t\t\t}\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\n\t\t\tthis.addBtnOffset = this.addBtn.offset();\n\t\t\tthis.noItems = this.element.find(this.options.noItems);\n\t\t\tthis.editForm = $(this.options.editForm);\n\n\t\t\tTwig.twig({\n\t\t\t\tid: 'item_template',\n\t\t\t\tdata: this.element.find(this.options.itemTemplate).html()\n\t\t\t});\n\n\t\t\t/* global CodeMirror */\n\t\t\tcodeMirror = CodeMirror.fromTextArea($(this.options.addBulkList).get(0), {\n\t\t\t\ttheme: \"monokai\",\n\t\t\t\tlineNumbers: true,\n\t\t\t\tlineWrapping : false,\n\t\t\t\tautoRefresh: true,\n\t\t\t\tstyleActiveLine: true,\n\t\t\t\tfixedGutter: true,\n\t\t\t\tcoverGutterNextToScrollbar: false,\n\t\t\t\tindentWithTabs: true,\n\t\t\t\tindentUnit: 4\n\t\t\t});\n\n\t\t\tthis.getItems();\n\t\t},\n\n\t\taddItem: function() {\n\t\t\tthis._saveItem('add_item', {});\n\t\t},\n\n\t\tupdateItem: function(data, id) {\n\t\t\tthis._saveItem('update_item', data, id);\n\t\t},\n\n\t\tgetItems: function() {\n\t\t\tvar self = this;\n\n\t\t\t$.getJSON(this.options.ajaxUrl + 'load_items', function(data) {\n\t\t\t\tself.nestedList.empty();\n\t\t\t\tself._resetActions();\n\n\t\t\t\tif (data.items !== undefined && data.items.length > 0) {\n\t\t\t\t\tself._showActions();\n\t\t\t\t\tself._addToTree(data.items);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tgetCodeMirrorInstance: function() {\n\t\t\treturn codeMirror;\n\t\t},\n\n\t\tshowMessage: function(message) {\n\t\t\tif (message) {\n\t\t\t\tthis.msgObj.text(message);\n\t\t\t\tthis.msgObj.fadeIn().delay(3000).fadeOut();\n\t\t\t}\n\t\t},\n\n\t\t_addBulk: function(data) {\n\t\t\tvar self = this;\n\t\t\t$.post(this.options.ajaxUrl + 'add_bulk', data,\n\t\t\t\tfunction(resp) {\n\t\t\t\t\tif (!resp.error) {\n\t\t\t\t\t\tself._showActions();\n\t\t\t\t\t\tself._addToTree(resp.items);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.showMessage(resp.error);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t'json'\n\t\t\t);\n\t\t},\n\n\t\t_addToTree: function(items, callback) {\n\t\t\t/* jshint sub: true */\n\t\t\tif (items.length > 0) {\n\t\t\t\tvar html = {};\n\t\t\t\tvar item = items.shift();\n\n\t\t\t\titem[this.options.fields.itemTitle] = item[this.options.fields.itemTitle] || lang.changeMe;\n\n\t\t\t\tif (item[this.options.fields.parentId] > 0) {\n\t\t\t\t\tvar parentObj = $('#item-' + item[this.options.fields.parentId]);\n\t\t\t\t\tvar children = parentObj.children(this.options.listType);\n\n\t\t\t\t\tif (children.length === 0) {\n\t\t\t\t\t\thtml = $('<' + this.options.listType + '>' + this._renderItem(item) + '</' + this.options.listType + '>').hide();\n\t\t\t\t\t\thtml.appendTo(parentObj);\n\t\t\t\t\t} else {\n\t\t\t\t\t\thtml = $(this._renderItem(item)).hide();\n\t\t\t\t\t\thtml.appendTo(parentObj.children(this.options.listType));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\thtml = $(this._renderItem(item)).hide();\n\t\t\t\t\thtml.appendTo(this.nestedList);\n\t\t\t\t}\n\n\t\t\t\tvar self = this;\n\t\t\t\thtml.effect('slide', {'direction': 'right', 'mode': 'show'}, this.options.loadSpeed, function() {\n\t\t\t\t\tself._addToTree(items, callback);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (callback !== undefined) {\n\t\t\t\tcallback.apply(this, [items]);\n\t\t\t}\n\t\t\tthis._trigger('loaded', null, {items: items});\n\t\t},\n\n\t\t_checkRequired: function() {\n\t\t\t$(this.dialogID + ' .error').remove();\n\n\t\t\tvar response = true;\n\n\t\t\t$(this.dialogID + ' .required').each(function() {\n\t\t\t\tif (!$(this).val()) {\n\t\t\t\t\t$('<div class=\"error\">' + lang.required + '</div>').insertAfter(this);\n\t\t\t\t\tresponse = false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn response;\n\t\t},\n\n\t\t_getItemId: function(element) {\n\t\t\treturn element.attr('id').substring(5);\n\t\t},\n\n\t\t_getOptions: function(list, padding, options) {\n\t\t\tvar self = this;\n\n\t\t\tlist.children('li').each(function(i, element) {\n\t\t\t\tvar item = $(element);\n\t\t\t\tvar id = self._getItemId(item);\n\t\t\t\tvar title = padding + '&#x251c;&#x2500; ' + item.find('.editable:first').text();\n\t\t\t\tvar option = '<option value=\"' + id + '\">' + title + '</option>';\n\n\t\t\t\toptions += self._getOptions(item.children('ol'), '&nbsp;&nbsp;&nbsp;&nbsp;' + padding, option);\n\t\t\t});\n\n\t\t\treturn options;\n\t\t},\n\n\t\t_makeEditable: function(element) {\n\t\t\tif (this.editing === true) {\n\t\t\t\tthis.editor.trigger('blur');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.editing = true;\n\t\t\tthis.editorVal = (element.text() !== lang.changeMe) ? element.text() : '';\n\n\t\t\telement.replaceWith('<form id=\"inline-form\"><input type=\"text\" id=\"inline-edit\" value=\"' + this.editorVal + '\" /></form>');\n\t\t\tthis.editor = $('#inline-edit').data('field', element.data('field')).focus().select();\n\t\t},\n\n\t\t_populateForm: function(id, callBack) {\n\t\t\tvar self = this;\n\t\t\t$.get(this.options.ajaxUrl + 'load_item?' + this.options.fields.itemId + '=' + id, function(data) {\n\t\t\t\tself.showMessage(data.message);\n\t\t\t\tself.editForm.populate(data);\n\t\t\t\tcallBack(self.dialogID);\n\t\t\t}, 'json');\n\n\t\t\treturn {};\n\t\t},\n\n\t\t_processEditable: function(e) {\n\t\t\tif (this.editing === false) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar id = this._getItemId($(e).parentsUntil('li').parent());\n\t\t\tvar field = $(e).data('field');\n\t\t\tvar val = $(e).val();\n\t\t\tvar data = {};\n\n\t\t\tif (id && field && val && val !== this.editorVal) {\n\t\t\t\tdata[field] = val;\n\t\t\t\tdata.field = field;\n\t\t\t\tthis._saveItem('update_item', data, id, field);\n\t\t\t} else {\n\t\t\t\tthis._undoEditable(this.editorVal ? this.editorVal : lang.changeMe);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t_resetActions: function(itemsCount) {\n\t\t\tvar display = 'initial';\n\n\t\t\tif (!itemsCount) {\n\t\t\t\tthis.noItems.show();\n\t\t\t\tdisplay = 'none';\n\t\t\t}\n\n\t\t\tthis.itemsChanged = false;\n\t\t\tthis.addBulkBtn.parent().next().slideUp();\n\t\t\tthis.selectAllObj.prop('checked', false).parent().css('display', display);\n\t\t\tthis.deleteSelBtn.button('disable').css('display', display);\n\t\t\tthis.saveBtn.button('disable').css('display', display);\n\t\t\tthis.rebuildBtn.css('display', display);\n\t\t},\n\n\t\t_saveItem: function(mode, data, id, field) {\n\t\t\tvar self = this;\n\t\t\t$.post(this.options.ajaxUrl + mode + ((id) ? '?' + this.options.fields.itemId + '=' + id : ''), data, function(resp) {\n\t\t\t\tif (!resp.error) {\n\t\t\t\t\tswitch (mode) {\n\t\t\t\t\t\tcase 'add_item':\n\t\t\t\t\t\t\tself._addToTree([resp], function() {\n\t\t\t\t\t\t\t\tvar element = $('#item-' + resp[self.options.fields.itemId]);\n\n\t\t\t\t\t\t\t\tself._showActions();\n\t\t\t\t\t\t\t\tself._scrollTo(element, self.addBtnOffset.top, function() {\n\t\t\t\t\t\t\t\t\tif (!self.options.dialogEdit.length) {\n\t\t\t\t\t\t\t\t\t\telement.find('.editable').trigger('click');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'update_item':\n\t\t\t\t\t\t\tif (self.editing) {\n\t\t\t\t\t\t\t\tself._undoEditable(resp[field]);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tself._refreshItem(resp);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'save_item':\n\t\t\t\t\t\t\tvar element = self._refreshItem(resp);\n\t\t\t\t\t\t\tself._trigger('updated', null, element);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tself.showMessage(resp.error);\n\n\t\t\t\t\tif (self.editing) {\n\t\t\t\t\t\tself._undoEditable(self.editorVal);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, 'json');\n\t\t},\n\n\t\t_saveTree: function() {\n\t\t\tvar data = $(this.options.nestedList).find('li').length ? this.nestedList.nestedSortable('toArray') : [];\n\n\t\t\tthis._saveItem('save_tree', {\n\t\t\t\t'tree': data\n\t\t\t});\n\t\t\tthis._resetActions(data.length);\n\t\t},\n\n\t\t_scrollTo: function(element, fromHeight, callback) {\n\t\t\tvar offset = element.offset();\n\t\t\tvar offsetTop = offset.top;\n\t\t\tvar totalScroll = offsetTop - fromHeight;\n\n\t\t\tthis.nestedList.animate({\n\t\t\t\tscrollTop: totalScroll\n\t\t\t}, 1000, callback);\n\t\t},\n\n\t\t_showActions: function() {\n\t\t\tthis.noItems.hide();\n\t\t\tthis.nestedList.show();\n\t\t\tthis.selectAllObj.parent().show();\n\t\t\tthis.deleteSelBtn.show();\n\t\t\tthis.saveBtn.show();\n\t\t\tthis.rebuildBtn.button('enable').show();\n\t\t},\n\n\t\t_removeNode: function(node) {\n\t\t\tnode.remove();\n\t\t\t// if node (li) has no sibblings, remove parent (ol/ul) unless it is the root ol/ul\n\t\t\tif (!node.siblings().length) {\n\t\t\t\tnode.parent(this.options.listType).not(this.options.nestedList).remove();\n\t\t\t}\n\t\t},\n\n\t\t_renderItem: function(data) {\n\t\t\treturn Twig.twig({ref: 'item_template'}).render(data);\n\t\t},\n\n\t\t_refreshItem: function(data) {\n\t\t\tvar replacement = $(this._renderItem(data)).children();\n\t\t\treturn $('#item-' + data[this.options.fields.itemId]).children(':first').replaceWith(replacement);\n\t\t},\n\n\t\t_undoEditable: function(v) {\n\t\t\tthis.editorVal = '';\n\t\t\tthis.editing = false;\n\t\t\tthis.editor.parent().replaceWith('<span class=\"editable\" data-field=\"' + this.editor.data('field') + '\">' + v + '</span>');\n\t\t},\n\n\t\t_submitForm: function(itemID) {\n\t\t\tvar action = itemID ? 'save_item' : 'add_item';\n\t\t\tthis._saveItem(action, this.editForm.serializeArray(), itemID);\n\t\t}\n\t});\n})(jQuery, window, document);"]}